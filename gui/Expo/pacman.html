<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pac-Man Nivel 1</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #score {
      margin: 12px;
      font-size: 24px;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(28, 20px);
      grid-template-rows: repeat(31, 20px);
      gap: 1px;
    }
    .cell {
      width: 20px;
      height: 20px;
      background: #222;
      position: relative;
    }
    .wall {
      background: #444;
    }
    .dot {
      width: 4px;
      height: 4px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .pellet {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .pacman {
      width: 100%;
      height: 100%;
      background: yellow;
      border-radius: 50%;
      position: absolute;
      top: 0; left: 0;
    }
    .ghost {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0; left: 0;
    }
    #game-over {
      margin-top: 16px;
      font-size: 36px;
      color: red;
      display: none;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <div id="game"></div>
  <div id="game-over">GAME OVER</div>

  <script>
    const COLS = 28, ROWS = 31;
    const gameEl = document.getElementById('game');
    const scoreEl = document.getElementById('score');
    const overEl  = document.getElementById('game-over');
    let score = 0, gameOver = false;

    // Posiciones iniciales
    let pacman = { x: 14, y: 23 };
    const ghosts = [
      { x: 13, y: 11 },
      { x: 14, y: 11 },
      { x: 15, y: 11 },
      { x: 14, y: 13 }
    ];

    // 0 = punto, 1 = pared, 2 = power-pellet, 3 = pasillo vacío sin punto
    const rawMap = [
      "1111111111111111111111111111",
      "1000000000110000000000000001",
      "1011111110111011111111111101",
      "1010000010000010000010000101",
      "1010111010111010111010110101",
      "1010100010100010100010100101",
      "1010101110101110101110100101",
      "1010101000000000010100100101",
      "1010101011111111010100100101",
      "1010001000000000010000100001",
      "1011111011111111110111111101",
      "1000000010000010001000000001",
      "1111111110111010111111111111",
      "0000000000100010000000000000", // túnel
      "1111111110111010111111111111",
      "1000000010000010001000000001",
      "1011111011111111110111111101",
      "1010000010000010000010000101",
      "1010111110111011111110110101",
      "1010100000000000000000100101",
      "1010101111110111111010100101",
      "1010001000000100001000100001",
      "1011111011111111110111111101",
      "1000000010000010001000000001",
      "1111111110111010111111111111",
      "1000000000110000000000000001",
      "1111111111111111111111111111",
      "1000000000110000000000000001",
      "1111111110111010111111111111",
      "1000000000110000000000000001",
      "1111111111111111111111111111"
    ];
    const map = rawMap.map(r => r.split('').map(ch => +ch));

    // Generar celdas
    const cells = [];
    for (let y = 0; y < ROWS; y++) {
      for (let x = 0; x < COLS; x++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        gameEl.appendChild(cell);
        cells.push(cell);
      }
    }

    function getCell(x, y) {
      // manejo de túneles laterales
      if (x < 0) x = COLS - 1;
      if (x >= COLS) x = 0;
      return cells[y * COLS + x];
    }

    function draw() {
      // limpia
      cells.forEach(c => {
        c.className = 'cell';
        c.innerHTML = '';
      });

      // dibuja mapa
      for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
          const v = map[y][x];
          const cell = getCell(x, y);
          if (v === 1) {
            cell.classList.add('wall');
          } else if (v === 0) {
            cell.innerHTML = '<div class="dot"></div>';
          } else if (v === 2) {
            cell.innerHTML = '<div class="pellet"></div>';
          }
        }
      }

      // dibuja fantasmas (usa tu imagen)
      ghosts.forEach(g => {
        const img = document.createElement('img');
        img.src = 'images/fantasma_1.png';          // ← reemplaza por la ruta de tu imagen
        img.classList.add('ghost');
        getCell(g.x, g.y).appendChild(img);
      });

      // dibuja Pac-Man
      const pm = document.createElement('div');
      pm.classList.add('pacman');
      getCell(pacman.x, pacman.y).appendChild(pm);
    }

    function movePac(dx, dy) {
      if (gameOver) return;
      let nx = pacman.x + dx;
      let ny = pacman.y + dy;

      // pasillo túnel
      if (nx < 0) nx = COLS - 1;
      if (nx >= COLS) nx = 0;

      if (map[ny][nx] !== 1) {
        pacman.x = nx;
        pacman.y = ny;
        const cellVal = map[ny][nx];
        if (cellVal === 0) { score += 10; map[ny][nx] = 3; }
        if (cellVal === 2) { score += 50; map[ny][nx] = 3; }
        scoreEl.textContent = `Score: ${score}`;
        checkCollision();
        draw();
      }
    }

    function checkCollision() {
      ghosts.forEach(g => {
        if (g.x === pacman.x && g.y === pacman.y) {
          gameOver = true;
          overEl.style.display = 'block';
        }
      });
    }

    function moveGhosts() {
      if (gameOver) return;
      ghosts.forEach(g => {
        const dx = pacman.x - g.x;
        const dy = pacman.y - g.y;
        const sx = Math.sign(dx), sy = Math.sign(dy);

        // intenta mover en x, sino en y
        if (map[g.y][g.x + sx] !== 1) {
          g.x += sx;
        } else if (map[g.y + sy] && map[g.y + sy][g.x] !== 1) {
          g.y += sy;
        }
      });
      checkCollision();
      draw();
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp')    movePac( 0, -1);
      if (e.key === 'ArrowDown')  movePac( 0,  1);
      if (e.key === 'ArrowLeft')  movePac(-1,  0);
      if (e.key === 'ArrowRight') movePac( 1,  0);
    });

    // arranque
    draw();
    setInterval(moveGhosts, 200);  // fantasmas vuelan cada 200 ms
  </script>
</body>
</html>